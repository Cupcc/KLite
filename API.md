## API参考手册(V4.3)

### 1.头文件
    KLite所有API都在"kernel.h"
	因此只需要:
	#include "kernel.h"

### 2.数据类型
    thread_t     线程标识符
    mutex_t      互斥锁标识符
    event_t      事件标识符
    sem_t        信号量标识符

### 3.函数说明
#### 3.1 内核相关
-------------------------------------------------------------------------------
    void kernel_init(uint32_t heap_addr, uint32_t heap_size)
    功能： 
        内核初始化.
    参数： 
        addr    动态管理内存起始地址
        size    动态管理内存大小 
    返回值： 
        无
    备注：
        在调用内核初始化时保证中断处于关闭状态,此函数只能执行一次,
        在初始化内核之前不可调用内核其它函数.
        
-------------------------------------------------------------------------------
    void kernel_start(void)
    功能： 
        启动内核,内部调用底层函数cpu_sys_start,启动滴答定时器.
    参数： 
        无 
    返回值： 
        无
    备注：
        此函数不会返回,所以在调用之前应该创建一个用户线程.
        
-------------------------------------------------------------------------------
    void kernel_tick(uint32_t time)
    功能：
        内核时间计时
    参数：
        time 计时时间(毫秒)
    返回值：
        无
    备注：
        此函数由滴答时钟中断程序调用, 应用程序不应该调用此函数.
        

------------------------------------------------------------------------------- 
    uint32_t kernel_time(void)
    功能：
        返回内核从启动到现在所经历的时间(毫秒).
    参数：
        无
    返回值：
        系统时间(毫秒)
        
------------------------------------------------------------------------------- 
    void kernel_idle(void)
    功能：
        处理内核空闲事务,回收线程资源
    参数：
        无
    返回值：
        无
    备注：
        此函数不会返回,需要单独创建一个用户线程,并直接调用.
        
------------------------------------------------------------------------------- 
    uint32_t kernel_idle_time(void)
    功能：
        返回内核从启动到现在空闲线程所运行的时间(毫秒).
    参数：
        无
    返回值：
        系统空闲时间(毫秒)

-------------------------------------------------------------------------------
    uint32_t kernel_version(void)
    功能：
        返回KLite内核的版本号
    参数：
        无
    返回值：
        版本号,BIT[31：24]主版本号,BIT[23：16]次版本号,BIT[15：0]修订号

#### 3.2 内存管理
-------------------------------------------------------------------------------
    void* heap_alloc(uint32_t size)
    功能：
        向内核申请一段连续内存,功能和malloc一样
    参数：
        size    要申请的内存大小
    返回值：
        申请成功返回内存指针
        申请失败返回NULL
    备注：
        使用heap_alloc申请的内存,在使用完毕后,请使用heap_free释放内存.
        
-------------------------------------------------------------------------------
    void heap_free(void *mem)
    功能：
        释放由heap_malloc申请的内存,功能和free一样
    参数：
        mem     由heap_alloc申请的内存指针
    返回值：
        无
    备注：
        使用heap_alloc申请的内存,在使用完毕后,请使用heap_free释放内存. 
        
-------------------------------------------------------------------------------
    void heap_usage(uint32_t *total, uint32_t *used)
    功能：
        获取内存用量信息
    参数：
        used    输出已使用的内存数量(字节)
        total   输出总内存数量(字节)
    返回值：
        无
    备注：
        可使用此函数关注系统内存消耗,以适当调整内存分配.

#### 3.3 线程管理
-------------------------------------------------------------------------------
    thread_t thread_create(void(*entry)(void*), void *arg, uint32_t stack_size)
    功能：
        创建一个新的线程,并加入就绪队列
    参数：
        entry      线程入口函数
        arg        线程入口函数的参数
        stack_size 线程拥有的栈空间大小,如果该值为0则使用系统默认值
    返回值：
        成功返回线程标识符
        失败返回NULL
    备注：
        内核自动为新线程分配内存空间和栈空间,如果栈设置太小容易在运行过程中产
        生栈溢出错误,如果设置太大可能会由于系统内存不足而创建失败.
        
-------------------------------------------------------------------------------
    void thread_delete(thread_t thread)
    功能：
        结束一个线程,并释放内存
    参数：
        thread  要结束的线程标识符
    返回值：
        无
    备注：
        该函数会直接停止线程运行,并释放线程所占用的内存.
        该函数不能用来结束当前线程.
        如果想要结束当前线程请使用thread_exit()或直接使用return.
        
-------------------------------------------------------------------------------
    void thread_set_priority(thread_t thread, int prio)
    功能：
        设置线程优先级
    参数：
        thread      线程标识符
        prio        新的优先级
    返回值：
        无
    备注：
        线程优先级决定线程调度顺序,越高的优先级具有越高的实时性,默认优先级为0.
        
-------------------------------------------------------------------------------
    int thread_get_priority(thread_t thread)
    功能：
        获取线程当前优先级
    参数：
        thread  线程标识符
    返回值：
        该线程当前的优先级
        
-------------------------------------------------------------------------------
    thread_t thread_self(void)
    功能：
        获取当前线程标识符
    参数：
        无
    返回值：
        当前线程的标识符
        
-------------------------------------------------------------------------------
    void thread_sleep(uint32_t time)
    功能：
        将当前线程休眠一段时间,释放CPU控制权
    参数：
        time    休眠时间(毫秒)
    返回值：
        无
    备注：
        如果time参数为0,则函数直接返回.
        
-------------------------------------------------------------------------------
    void thread_exit(void)
    功能：
        退出当前线程
    参数：
        无
    返回值：
        无
    备注：
        此函数不会立即释放线程资源,需等待系统空闲时释放.
        
-------------------------------------------------------------------------------
    void thread_suspend(void)
    功能：
        挂起当前线程
    参数：
        无
    返回值：
        无

-------------------------------------------------------------------------------
    void thread_resume(thread_t thread)
    功能：
        恢复被挂起的线程
    参数：
        thread  线程标识符
    返回值：
        无
    备注：
        只能用来恢复处于挂起状态的线程.
        
-------------------------------------------------------------------------------
    uint32_t thread_time(thread_t thread)
    功能：
        获取线程自创建以来所占用CPU的时间.
    参数：
        thread  线程标识符
    返回值：
        线程运行的时间(毫秒)
    备注：
        可以使用此函数来监控线程的CPU占用率
        
#### 3.4 互斥锁
-------------------------------------------------------------------------------
    mutex_t mutex_create(void)
    功能：
        创建一个新的互斥锁
    参数：
        无
    返回值：
        成功返回互斥锁标识符
        失败返回NULL
    备注：
        互斥锁支持递归调用.
    
-------------------------------------------------------------------------------
    void mutex_lock(mutex_t mutex)
    功能：
        将mutex指定的互斥锁标记为锁定状态
    参数：
        mutex   互斥锁标识符
    返回值：
        无
    备注：
        如果mutex指向的互斥锁已被其它线程锁定,则调用线程将会被阻塞,直到另一个
        线程释放这个互斥锁.
        
-------------------------------------------------------------------------------
    bool mutex_try_lock(mutex_t mutex)
    功能：
        尝试将mutex指定的互斥锁标记为锁定状态
    参数：
        mutex   互斥锁标识符
    返回值：
        锁定成功,则返回true;锁定失败则返回false.
    备注：
        此函数是mutex_lock的非阻塞版本.
        
-------------------------------------------------------------------------------
    void mutex_unlock(mutex_t mutex)
    功能：
        释放由参数mutex指定的互斥锁
    参数：
        mutex   互斥锁标识符
    返回值：
        无
    备注：
        mutex_lock和mutex_unlock必须成对出现.
        
-------------------------------------------------------------------------------
    void mutex_delete(mutex_t mutex)
    功能：
        删除一个互斥锁,释放内存
    参数：
        mutex   被删除的互斥锁标识符
    返回值：
        无
    备注：
        在删除互斥锁的时候不会检查是否有线程拥有这个互斥锁.
        因此在删除之前请确认没有线程在使用.

#### 3.5 信号量
-------------------------------------------------------------------------------
    sem_t sem_create(uint32_t init_value, uint32_t max_value)
    功能：
        创建一个新的信号量对象.
    参数：
        init_value: 信号量初始值
        max_value:  信号量计数最大值
    返回值：
        创建成功返回信号量标识符.
        创建失败返回NULL.
    备注：
        init_value必须小于或等于max_value.

-------------------------------------------------------------------------------
    void sem_delete(sem_t sem)
    功能：
        删除对象,并释放内存.
    参数：
        sem   信号量标识符.
    返回值：
        无.
    备注：
        在没有线程使用它时才能删除,否则可能产生未知的异常.

-------------------------------------------------------------------------------
    void sem_post(sem_t sem)
    功能：
        信号量计数值加1.
    参数：
        sem   信号量标识符.
    返回值：
        无.
    备注：
        如果有线程在等待信号量,此函数会唤醒其中一个线程.

-------------------------------------------------------------------------------
    void sem_wait(sem_t sem)
    功能：
        信号量计数值减1.
    参数：
        sem   信号量标识符.
    返回值：
        无.
    备注：
        如果当前信号量计数值为0，则线程阻塞，直到计数值大于0.

-------------------------------------------------------------------------------
    bool sem_timed_wait(sem_t sem, uint32_t timeout)
    功能：
        信号量计数值减1.
    参数：
        sem     信号量标识符.
        timeout 超时时间,单位为毫秒.
    返回值：
        操作成功返回true.
        操作超时返回false.
    备注：
        如果当前信号量计数值为0，则线程阻塞，直到计数值大于0，或者阻塞时间超过
        timeout指定的时间。

-------------------------------------------------------------------------------
    void sem_get_value(sem_t sem, uint32_t *value);
    功能：
        读取信号量计数值.
    参数：
        sem   信号量标识符.
        value 返回信号量计数值的地址
    返回值：
        无.
    备注：
        无

#### 3.6 事件
-------------------------------------------------------------------------------
    event_t event_create(bool auto_reset)
    功能：
        创建一个新的事件对象.
    参数：
        auto_reset 是否自动复位事件状态
    返回值：
        创建成功返回事件标识符.
        创建失败返回NULL.
    备注：
        无
        
-------------------------------------------------------------------------------
    void event_delete(event_t event)
    功能：
        删除事件对象,并释放内存.
    参数：
        event   事件标识符.
    返回值：
        无.
    备注：
        在没有线程使用它时才能删除,否则可能产生未知的异常.

-------------------------------------------------------------------------------
    void event_set(event_t event)
    功能：
        标记事件为置位状态.
    参数：
        event   事件标识符.
    返回值：
        无.
    备注：
        如果auto_reset为true，那么会唤醒等待队列中的第1个线程，并且将事件自动复位.
        如果auto_reset为false，那么会唤醒等待队列中的所有线程，并且将事件保持置位.

-------------------------------------------------------------------------------
    void event_reset(event_t event)
    功能：
        标记事件为复位状态.
    参数：
        event   事件标识符.
    返回值：
        无.
    备注：
        此函数不会唤醒任何被event挂起的线程.

-------------------------------------------------------------------------------
    void event_pulse(event_t event)
    功能：
        唤醒正在等待事件的线程，但不改变事件原有的状态.
    参数：
        event   事件标识符.
    返回值：
        无.
    备注：
        如果事件是置位状态，则此函数什么也不做.
        如果事件是复位状态，且auto_reset为true，那么会唤醒等待队列中的第1个线程.
        如果事件是复位状态，且auto_reset为false，那么会唤醒等待队列中的所有线程.
-------------------------------------------------------------------------------
    void event_wait(event_t event)
    功能：
        等待事件置位.
    参数：
        event   事件标识符.
    返回值：
        无.
    备注：
        无

-------------------------------------------------------------------------------
    bool event_timed_wait(event_t event, uint32_t timeout)
    功能：
        定时等待事件置位，如果等待时间超过timeout设定的时间则退出等待.
    参数：
        event   事件标识符.
        timeout 等待超时时间,单位为毫秒.
    返回值：
        等待成功返回true.
        等待超时返回false.
    备注：
        无
